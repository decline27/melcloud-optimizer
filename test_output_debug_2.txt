
> com.melcloud.optimize@14.0.1 test
> jest test/unit/optimizer.comfort_repro.test.ts

FAIL test/unit/optimizer.comfort_repro.test.ts
  Optimizer Comfort Regression Investigation
    ✕ should NOT aggressively cut temperature when efficiency is GOOD, even if price is EXPENSIVE (6 ms)

  ● Optimizer Comfort Regression Investigation › should NOT aggressively cut temperature when efficiency is GOOD, even if price is EXPENSIVE

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "device-1", 1, 34, 1
    Received: "device-1", 1, 33, 1

    Number of calls: 1

      62 |                 confidence: 0.9
      63 |             }),
    > 64 |             addCalibrationPoint: jest.fn()
         |                                           ^
      65 |         };
      66 |         (optimizer as any).copPredictor = mockPredictor;
      67 |

      at Object.<anonymous> (test/unit/optimizer.comfort_repro.test.ts:64:44)

---------------------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                             | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                                                                                                                                                          
---------------------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                        |    5.68 |     3.23 |    4.23 |    5.61 |                                                                                                                                                                                                                                                                                                            
 src                             |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                                                            
  api.ts                         |       0 |        0 |       0 |       0 | 2-208                                                                                                                                                                                                                                                                                                      
  app.ts                         |       0 |        0 |       0 |       0 | 2-1295                                                                                                                                                                                                                                                                                                     
  entsoe.ts                      |       0 |        0 |       0 |       0 | 2-483                                                                                                                                                                                                                                                                                                      
  metrics.ts                     |       0 |      100 |     100 |       0 | 2                                                                                                                                                                                                                                                                                                          
 src/config                      |       0 |      100 |     100 |       0 |                                                                                                                                                                                                                                                                                                            
  comfort-defaults.ts            |       0 |      100 |     100 |       0 | 8-14                                                                                                                                                                                                                                                                                                       
 src/orchestration               |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                                                            
  service-manager.ts             |       0 |        0 |       0 |       0 | 2-482                                                                                                                                                                                                                                                                                                      
 src/services                    |    8.94 |      4.9 |    7.54 |    8.94 |                                                                                                                                                                                                                                                                                                            
  adaptive-parameters.ts         |    6.02 |        0 |       0 |    6.02 | 33-244                                                                                                                                                                                                                                                                                                     
  base-api-service.ts            |       0 |        0 |       0 |       0 | 2-180                                                                                                                                                                                                                                                                                                      
  cop-helper.ts                  |     6.4 |        0 |       0 |     6.4 | 21-289                                                                                                                                                                                                                                                                                                     
  cop-predictor.ts               |    3.44 |        0 |       0 |     3.5 | 11-261                                                                                                                                                                                                                                                                                                     
  entsoe-price-service.ts        |       0 |        0 |       0 |       0 | 2-305                                                                                                                                                                                                                                                                                                      
  fx-rate-service.ts             |       0 |        0 |       0 |       0 | 2-142                                                                                                                                                                                                                                                                                                      
  melcloud-api.ts                |       0 |        0 |       0 |       0 | 2-1761                                                                                                                                                                                                                                                                                                     
  optimizer.ts                   |    14.9 |     8.03 |   14.73 |    14.9 | 106-227,252-381,392-438,447-448,453,466,475,485,493,508-974,990-1088,1096-1101,1122-1268,1282-1654,1666-1667,1681,1692-1704,1709,1716-1720,1749,1763-1781,1785-1799,1813-1817,1828,1836,1845-1857,1867-1879,1892-1932,1946-1953,1975-2070,2102-2103,2126-2132,2138-2139,2147,2159-2160,2163-2164,2202-3294 
  planning-utils.ts              |   14.49 |        0 |       0 |   14.92 | 13-89                                                                                                                                                                                                                                                                                                      
  price-classifier.ts            |   54.76 |    32.81 |    90.9 |   53.08 | 16,22,26,32-36,59-60,88,91,96-97,117-157                                                                                                                                                                                                                                                                   
  price-history-tracker.ts       |     3.7 |        0 |       0 |    3.94 | 10-199                                                                                                                                                                                                                                                                                                     
  tibber-api.ts                  |       0 |        0 |       0 |       0 | 2-362                                                                                                                                                                                                                                                                                                      
 src/services/hot-water          |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                                                            
  hot-water-analyzer.ts          |       0 |        0 |       0 |       0 | 9-376                                                                                                                                                                                                                                                                                                      
  hot-water-data-collector.ts    |       0 |        0 |       0 |       0 | 11-651                                                                                                                                                                                                                                                                                                     
  hot-water-service.ts           |       0 |        0 |       0 |       0 | 8-316                                                                                                                                                                                                                                                                                                      
  index.ts                       |       0 |      100 |       0 |       0 | 7-14                                                                                                                                                                                                                                                                                                       
 src/services/thermal-model      |    7.83 |     7.31 |    5.78 |    7.16 |                                                                                                                                                                                                                                                                                                            
  data-collector.ts              |    7.96 |      6.1 |    6.25 |    7.16 | 19-20,25,30-32,70-1087                                                                                                                                                                                                                                                                                     
  index.ts                       |   78.94 |    66.66 |      50 |   85.71 | 16-17                                                                                                                                                                                                                                                                                                      
  thermal-analyzer.ts            |    3.93 |        0 |       0 |     4.2 | 15-245                                                                                                                                                                                                                                                                                                     
  thermal-model-service.ts       |    3.36 |        0 |       0 |    3.46 | 17-591                                                                                                                                                                                                                                                                                                     
 src/types                       |       0 |        0 |       0 |       0 |                                                                                                                                                                                                                                                                                                            
  index.ts                       |       0 |        0 |       0 |       0 | 2-14                                                                                                                                                                                                                                                                                                       
 src/util                        |    4.31 |     0.56 |     2.7 |    4.37 |                                                                                                                                                                                                                                                                                                            
  circuit-breaker.ts             |       0 |        0 |       0 |       0 | 8-288                                                                                                                                                                                                                                                                                                      
  enhanced-savings-calculator.ts |    4.62 |     0.68 |    5.88 |    4.86 | 25-540,563                                                                                                                                                                                                                                                                                                 
  error-handler.ts               |   21.53 |     2.85 |      10 |   21.53 | 30-38,47-199                                                                                                                                                                                                                                                                                               
  fixed-baseline-calculator.ts   |    5.44 |        0 |    6.66 |    5.44 | 31-403                                                                                                                                                                                                                                                                                                     
  logger.ts                      |       0 |        0 |       0 |       0 | 2-355                                                                                                                                                                                                                                                                                                      
  setpoint-constraints.ts        |    5.26 |        0 |       0 |    5.26 | 7-91                                                                                                                                                                                                                                                                                                       
  time-zone-helper.ts            |    6.71 |     1.78 |    6.66 |    6.76 | 56-352                                                                                                                                                                                                                                                                                                     
  timeline-formatter.ts          |       0 |        0 |       0 |       0 | 6-148                                                                                                                                                                                                                                                                                                      
  timeline-helper.ts             |       0 |        0 |       0 |       0 | 7-538                                                                                                                                                                                                                                                                                                      
  validation.ts                  |   13.15 |        0 |       0 |   13.51 | 20-85                                                                                                                                                                                                                                                                                                      
---------------------------------|---------|----------|---------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Jest: "global" coverage threshold for statements (55%) not met: 5.68%
Jest: "global" coverage threshold for branches (45%) not met: 3.23%
Jest: "global" coverage threshold for lines (55%) not met: 5.61%
Jest: "global" coverage threshold for functions (60%) not met: 4.23%
Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 total
Snapshots:   0 total
Time:        5.114 s
Ran all test suites matching /test\/unit\/optimizer.comfort_repro.test.ts/i.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
